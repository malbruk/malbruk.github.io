---
title: מייל אוטומטי עם קובץ מצורף
date: 2020-07-17
tags: [גוגל]
---

אם ניסיתם אי פעם להגדיר בג'ימייל שליחה של מייל אוטומטי עם קובץ מצורף,

 אתם, מן הסתם, כבר יודעים שאין לכך פתרון מובנה.

רוצים לבנות את הפתרון לבד?

באמצעות כמה הגדרות ועוד כמה שורות קוד - גם המייל שלכם יידע לעשות את העבודה.

ולא, אתם לא חייבים לדעת לתכנת.

>ידע קודם נדרש:
>
>ג'ימייל ודרייב.
>
>אה, וגם העתק הדבק
🥰

אז מה אנחנו הולכים לעשות?

1. ניצור מסנן שיתייג בתווית יעודית את ההודעות הנכנסות הרלוונטיות.
2. ניצור קובץ pdf בדרייב. הקובץ הזה ישלח במענה האוטומטי.
3. ניצור סקריפט בדרייב שיעבור על כל ההודעות בתווית וישלח מייל מענה עם הקובץ שיצרנו.
4. נגדיר טריגר (מפעיל) לסקריפט שיריץ אותו כל דקה.

<Primary>
על הדרך נלמד טיפ נחמד איך לסדר את עורך הסקריפטים של גוגל שמתבלבל בין ימין לשמאל בדפדפן עברי.
</Primary>
אז קדימה.

## 1. יצירת מסנן
צרו מסנן עבור כל ההודעות שהנושא שלהן הוא לשם הדוגמא _קטלוג_, ולחצו על _מסנן חדש_.

![](../images/auto-reply-attach/create-filter-1.png)

הגדירו תווית חדשה בשם _new-mail_
![](../images/auto-reply-attach/create-filter-2.png)

שלחו לעצמכם מייל עם הנושא _קטלוג_ ובדקו שאכן המייל שנכנס תוייג בתווית _new_mail_.

## 2. יצירת קובץ PDF
העלו קובץ מסוג PDF לדרייב.

לחצו על הקובץ לחיצה ימנית ובחרו בתפריט _קבלת קישור שניתן לשתף_.

העתיקו מתוך הקישור את מזהה הקובץ ושמרו אותו בצד בינתיים.

המזהה הוא החלק בקישור שנמצא בין d/ ל-view/

![](../images/auto-reply-attach/pdf-link.png)

## 3. יצירת סקריפט
היכנסו לדרייב, לחצו על חדש -> עוד -> סקריפט של Google Apps.
![](../images/auto-reply-attach/create-script.png)

נפתח לנו טאב חדש עם עורך הסקריפטים של גוגל.

ראשית תנו לפרויקט שם כרצונכם במקום _פרויקט ללא כותרת_
![](../images/auto-reply-attach/edit-script-1.png)
החליפו את הקוד הקיים בקוד הזה:
```js
var file = DriveApp.getFileById('file_id').getAs('application/pdf')

function reply() {
  var label = GmailApp.getUserLabelByName('new-mail');
  var messages = label.getThreads();
  for(var i=0;i<messages.length;i++){
    messages[i].reply('attached',{
    attachments:[file]
  });
    messages[i].removeLabel(label);
  }
}
```

בשורה הראשונה של הקוד, החליפו את _file_id_ במזהה קובץ ה-PDF ששמרתם בצד.

שמרו בלחיצה על _שמור_ או ctrl+s.

הריצו בלחיצה על המשולש (מסומן בצילום מסך שלעיל)

תקפוץ לכם הודעה שנדרשת הרשאה. לחצו על _סקור הרשאות_.

תדרשו לבחור את החשבון שבו הסקריפט ירוץ, ומכיוון שהסקריפט לא מאומת על ידי גוגל, תופיע הודעה _האפליקציה הזו אינה מאומתת_.

לחצו על _מתקדם_ ואחר כך על _כניסה אל... (לא מאובטח)_

לאחר מכן יופיעו הפעולות שהסקריפט מבקש לקבל עבורן הרשאה. לחצו על _אישור_.
<Primary>
יתכן שהודעה זו תוקפץ שוב בהמשך אם הסקריפט ישתנה וידרוש הרשאות נוספות.
</Primary>

רוצו לבדוק את תיבת המייל שלכם!

נהדר! יש לכם סקריפט שמחזיר מייל עם קובץ מצורף.

זה הזמן להפוך אותו לאוטומטי.

## 4. יצירת מפעיל

 בעורך הסקריפטים לחצו בתפריט על הצגה -> הפעלות.
![](../images/auto-reply-attach/trigger-menu.png)
הדף שנפתח מציג את ההפעלות הקיימות בפרויקט, נכון לעכשיו אין הפעלות קימות.

 לחצו על שם הפרויקט כדי לעבור לתצוגה ברמת הפרויקט. (בדוגמא: tutorial)
![](../images/auto-reply-attach/trigger-2.png)

לחצו על שלוש הנקודות בצד שמאל לפתיחת התפריט, ובחרו _מפעילים_.
![](../images/auto-reply-attach/trigger-3.png)

לחצו על _הוספת טריגר_ בצד שמאל למטה.
![](../images/auto-reply-attach/trigger-4.PNG)

בחרו את הפונקציה והגדירו את התזמון הרצוי להפעלתה.
![](../images/auto-reply-attach/trigger-5.PNG)

זהו! שלבו ידיים. הרובוט יעבוד במקומכם...

אם ברצונכם למחוק את הטריגר, לחצו שוב על שלוש הנקודות ובחרו _מחיקת טריגר_.
![](../images/auto-reply-attach/trigger-6.PNG)
